-- ตารางสำหรับผู้ใช้ (Users)
CREATE TABLE users (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(191) NOT NULL UNIQUE,
  password CHAR(60) NOT NULL,
  role ENUM('user','admin') NOT NULL DEFAULT 'user',
  password_updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  login_attempts INT NOT NULL DEFAULT 0,
  locked_until DATETIME DEFAULT NULL,
  reset_token VARCHAR(100) DEFAULT NULL,
  reset_token_expiry DATETIME DEFAULT NULL,
  is_active BOOLEAN NOT NULL DEFAULT TRUE,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);


-- ตารางสำหรับเก็บประวัติการเข้าระบบ (Login Logs)
CREATE TABLE login_logs (
    id INTEGER NOT NULL AUTO_INCREMENT,
    username_attempt VARCHAR(255) NOT NULL,
    user_id INTEGER,
    timestamp DATETIME NOT NULL,
    is_success BOOLEAN NOT NULL,
    ip_address VARCHAR(50),
    PRIMARY KEY (id),
    FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE SET NULL
);

-- ตารางสำหรับเก็บรายการสั่งอาหาร (Orders)
CREATE TABLE orders (
  id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  user_id INT UNSIGNED NOT NULL,
  food_class ENUM('ECONOMY','PREMIUM') NOT NULL,
  items_json JSON NOT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);